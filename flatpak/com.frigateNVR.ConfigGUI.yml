app-id: com.frigateNVR.ConfigGUI
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: frigate-config-gui
finish-args:
  # X11 + XShm access
  - --share=ipc
  - --socket=x11
  # Wayland access
  - --socket=wayland
  # File system access for config files
  - --filesystem=home
  # Network access for updates and package installation
  - --share=network
  # Allow communication with host dbus
  - --socket=session-bus
  # For hardware acceleration
  - --device=dri
modules:
  - name: nodejs
    buildsystem: simple
    build-commands:
      - |
        ./configure --prefix=/app
        make -j $FLATPAK_BUILDER_N_JOBS
        make install
    sources:
      - type: archive
        url: https://nodejs.org/dist/v20.11.1/node-v20.11.1.tar.xz
        sha256: 85ca2c3d9df9b77e4ee826e03c10f5d2aa7ae35b7230390f2ea118e5d0d9b93f

  - name: frigate-config-gui
    buildsystem: simple
    build-commands:
      # Install npm dependencies (including TypeScript, React, and dev dependencies)
      - npm ci
      # Type check TypeScript
      - npm run type-check
      # Build TypeScript and bundle the application
      - npm run build
      # Install the application
      - cp -r dist/linux-unpacked/* /app/
      # Install desktop file and icons
      - install -Dm644 build/icon.png /app/share/icons/hicolor/512x512/apps/com.frigateNVR.ConfigGUI.png
      - install -Dm644 flatpak/com.frigateNVR.ConfigGUI.desktop /app/share/applications/com.frigateNVR.ConfigGUI.desktop
      - install -Dm644 flatpak/com.frigateNVR.ConfigGUI.appdata.xml /app/share/metainfo/com.frigateNVR.ConfigGUI.appdata.xml
    sources:
      - type: dir
        path: ../